<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ECHO AI</title>
  <style>
    body {
      background-color: #1c1c1e;
      color: #f5f5f7;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .chat-container {
      max-width: 100%;
      margin: 0;
      border-radius: 0;
      box-shadow: none;
      overflow: hidden;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      background-color: #3a3a3c;
      padding: 10px;
      text-align: center;
    }

    .chat-messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 10px;
      display: flex;
      flex-direction: column-reverse;
    }

.chat-input {
  display: flex;
  background-color: #1c1c1e;
  padding: 10px;
  position: sticky;
  bottom: 0;
  margin-bottom: 15px; /* Add margin to lift up the input and button */
}

    .chat-input input {
      flex-grow: 1;
      padding: 5px;
      border: none;
      border-radius: 5px;
      background-color: #1c1c1e;
      color: #f5f5f7;
      width: auto;
      height: auto;
    }

    .chat-input button {
      margin-left: 10px;
      padding: 5px 10px;
      border: none;
      border-radius: 5px;
      background-color: #007aff;
      color: #f5f5f7;
      cursor: pointer;
    }

    .message {
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 10px;
      display: flex;
      flex-direction: column;
    }

    .user {
      background-color: #3a3a3c;
      align-self: flex-end;
    }

    .bot {
      background-color: #007aff;
      align-self: flex-start;
    }

    .code-container {
      background-color: #005dbb;
      color: #abb2bf;
      padding: 10px;
      border-radius: 5px;
      font-family: 'Courier New', Courier, monospace;
      white-space: pre-wrap;
      overflow-x: auto;
    }

    .sub-container {
      background-color: #2c2c2e; /* slightly brighter grey */
      border-radius: 5px;
      padding: 5px;
      margin-top: 5px;
    }

    body {
      touch-action: manipulation;
    }

    input, textarea, select, button {
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="chat-header">
    <h2>ECHO</h2>
  </div>
  <div class="chat-container">
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input">
      <input type="text" id="messageInput" placeholder="Type your message...">
      <button id="sendButton">Send</button>
    </div>
  </div>

  <script>
    const chatMessages = document.getElementById('chatMessages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');

    // Function to send a message to the Chat API
    function sendMessage(message) {
      const apiUrl = 'https://pro-ai.glitch.me/api-chat';

      fetch(apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ input: message })
      })
      .then(response => response.json())
      .then(data => {
        // Replace the specific string in the API response
        const modifiedResponse = data.response.replace("Pro AI", "ECHO");

        // Handle the response from the Chat API
        displayMessageWithTypewriter('bot', modifiedResponse);
      })
      .catch(error => {
        console.error('Error:', error);
      });
    }

    // Function to display a message in the chat with a typewriter effect
    function displayMessageWithTypewriter(sender, message) {
      const messageElement = document.createElement('div');
      messageElement.classList.add('message', sender);
      chatMessages.prepend(messageElement);

      let i = 0;
      const typeWriter = () => {
        if (i < message.length) {
          const char = message.charAt(i);
          if (isCodeBlock(message, i)) {
            const codeContainer = document.createElement('div');
            codeContainer.classList.add('code-container');
            const codeText = message.slice(i, findEndOfCodeBlock(message, i));
            codeContainer.textContent = codeText;
            messageElement.appendChild(codeContainer);
            i += codeText.length;
          } else {
            messageElement.textContent += char;
            i++;
          }
          setTimeout(typeWriter, 50);
        } else {
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
      };

      typeWriter();
    }

    // Function to display a message in the chat without a typewriter effect
    function displayMessage(sender, message) {
      const messageElement = document.createElement('div');
      messageElement.classList.add('message', sender);
      chatMessages.prepend(messageElement);

      if (isCodeBlock(message, 0)) {
        const codeContainer = document.createElement('div');
        codeContainer.classList.add('code-container', 'sub-container');
        const codeText = message.slice(0, findEndOfCodeBlock(message, 0));
        codeContainer.textContent = codeText;
        messageElement.appendChild(codeContainer);
      } else {
        messageElement.textContent = message;
      }

      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Helper function to check if a code block starts at a given index
    function isCodeBlock(message, index) {
      const codeBlockStart = '```';
      return message.slice(index, index + codeBlockStart.length) === codeBlockStart;
    }

    // Helper function to find the end of a code block
    function findEndOfCodeBlock(message, startIndex) {
      const codeBlockEnd = '```';
      const endIndex = message.indexOf(codeBlockEnd, startIndex + 3);
      return endIndex === -1 ? message.length : endIndex + 3;
    }

    // Event listener for the send button
    sendButton.addEventListener('click', () => {
      const message = messageInput.value.trim();
      if (message) {
        displayMessage('user', message);
        sendMessage(message);
        messageInput.value = '';
      }
    });

    // Event listener for the Enter key
    messageInput.addEventListener('keydown', (event) => {
      if (event.key === 'Enter') {
        sendButton.click();
      }
    });

    document.addEventListener('gesturestart', function(e) {
      e.preventDefault();
    });
  </script>
</body>
</html>
